<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T√¨m Bundle ID App Store</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #f2f2f7;
  margin: 0; padding: 20px;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  flex-direction: column;
}
.container {
  width: 100%;
  max-width: 420px;
  background: #fff;
  padding: 24px 20px 30px;
  border-radius: 16px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  text-align: center;
  align-self: center;
}
h2 {
  margin: 0 0 15px;
  font-size: 22px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
h2 img {
  width: 22px; height: 22px;
}
input, select, button {
  width: 100%;
  padding: 12px 14px;
  font-size: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
  outline: none;
  box-sizing: border-box;
  margin-top: 10px;
  text-align: center;
}
select { background: #f8f8f8; text-align-last: center; }
button {
  background: #007aff;
  color: white;
  border: none;
  cursor: pointer;
  font-weight: 500;
  transition: 0.2s;
}
button:hover { background: #005ecb; }
.note {
  display: none;
  font-size: 13px;
  color: #666;
  margin-top: 10px;
  line-height: 1.5;
}
.app {
  display: flex;
  align-items: flex-start;
  border-bottom: 1px solid #eee;
  padding: 12px 0;
}
.app a img {
  width: 60px; height: 60px;
  border-radius: 12px;
  margin-right: 12px;
  transition: 0.2s;
  object-fit: cover;
  background: #f3f3f3;
}
.app a img:hover { transform: scale(1.05); }
.app-info { text-align: left; flex: 1; }
.bundle {
  background: #f1f1f1;
  padding: 4px 8px;
  border-radius: 8px;
  font-family: monospace;
  cursor: pointer;
  user-select: all;
  display: inline-block;
  color: #007aff;
}
.bundle.disabled {
  cursor: default;
  opacity: 0.6;
  user-select: text;
  color: #666;
}
.bundle:hover { background: #e5e5e5; }
#results { margin-top: 20px; text-align: left; }

.short-desc {
  display: block;
  font-size: 14px;
  color: #555;
  margin: 5px 0 2px 0;
  font-style: italic;
}

.footer {
  text-align: center;
  margin-top: 25px;
  font-size: 14px;
}
.footer a {
  text-decoration: none;
  color: #007aff;
  font-weight: 500;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: color 0.3s ease;
}
.footer a:hover { color: #005ecb; }
.arrow {
  display: inline-block;
  transition: transform 0.4s ease, opacity 0.4s ease;
}
.footer a:active { transform: scale(0.97); }

/* Site credit at page bottom */
.site-credit {
  text-align: center;
  color: #888;
  font-size: 13px;
  margin-top: 12px;
  align-self: center;
}

/* Small screens tweak */
@media (max-width: 420px) {
  .container { padding: 18px 14px 22px; border-radius: 12px; }
  h2 { font-size: 20px; }
}
</style>
</head>
<body>
  <div class="container">
    <h2><img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg" alt="Apple"> T√¨m Bundle ID App Store</h2>
    <input type="text" id="appName" placeholder="Nh·∫≠p t√™n ·ª©ng d·ª•ng (VD: Facebook, Zalo...)">
    <select id="country">
      <option value="VN" selected>üáªüá≥ Vi·ªát Nam</option>
      <option value="US">üá∫üá∏ Hoa K·ª≥</option>
      <option value="JP">üáØüáµ Nh·∫≠t B·∫£n</option>
      <option value="KR">üá∞üá∑ H√†n Qu·ªëc</option>
      <option value="SG">üá∏üá¨ Singapore</option>
      <option value="CN">üá®üá≥ Trung Qu·ªëc</option>
      <option value="RU">üá∑üá∫ Nga</option>
    </select>
    <button id="searchBtn">T√¨m ki·∫øm</button>
    <div class="note" id="copyNote">
      üí° ·∫§n v√†o <b>Icon</b> ƒë·ªÉ m·ªü App Store<br>
      üí° ·∫§n v√†o <b>Bundle ID</b> ƒë·ªÉ sao ch√©p
    </div>
    <div id="results"></div>

    <div class="footer">
      <a href="https://nhut990.github.io/Bundle/icon/" id="getAppIcon" style="margin-bottom:10px;display:inline-block;">
        üñºÔ∏è L·∫•y icon App Store
      </a>
      <a href="#" id="homeLink">
        <span class="arrow" id="arrow">‚¨ÖÔ∏è</span> Quay v·ªÅ trang ch·ªß
      </a>
    </div>
  </div>

  <div class="site-credit">Created by Minh Nhut</div>

<script>
(function () {
  var searchBtn = document.getElementById('searchBtn');
  var appNameInput = document.getElementById('appName');
  var countrySelect = document.getElementById('country');
  var resultsDiv = document.getElementById('results');
  var copyNote = document.getElementById('copyNote');
  var homeLink = document.getElementById('homeLink');
  var arrow = document.getElementById('arrow');

  var placeholderSvg = encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">' +
    '<rect fill="%23eee" width="100" height="100"/>' +
    '<text x="50" y="55" font-size="12" text-anchor="middle" fill="%23999">No Image</text>' +
    '</svg>'
  );
  var placeholderUrl = 'data:image/svg+xml;charset=UTF-8,' + placeholderSvg;

  // Danh s√°ch m√¥ t·∫£ ng·∫Øn cho c√°c app ph·ªï bi·∫øn
  var SHORT_DESCS = {
    "zalo": "Nh·∫Øn tin & g·ªçi ƒëi·ªán mi·ªÖn ph√≠.",
    "facebook": "M·∫°ng x√£ h·ªôi chia s·∫ª k·∫øt n·ªëi b·∫°n b√®.",
    "youtube": "Xem video tr·ª±c tuy·∫øn.",
    "messenger": "Nh·∫Øn tin, g·ªçi video mi·ªÖn ph√≠.",
    "instagram": "Chia s·∫ª h√¨nh ·∫£nh, m·∫°ng x√£ h·ªôi.",
    "shopee": "Mua s·∫Øm tr·ª±c tuy·∫øn.",
    "tiktok": "M·∫°ng x√£ h·ªôi video ng·∫Øn.",
    "grab": "ƒê·∫∑t xe, giao ƒë·ªì ƒÉn.",
    "gmail": "Qu·∫£n l√Ω v√† g·ª≠i nh·∫≠n email.",
    "mocha": "Nh·∫Øn tin, g·ªçi ƒëi·ªán, k·∫øt b·∫°n.",
    "viber": "Nh·∫Øn tin, g·ªçi ƒëi·ªán mi·ªÖn ph√≠.",
    "telegram": "Nh·∫Øn tin b·∫£o m·∫≠t.",
    "twitter": "M·∫°ng x√£ h·ªôi chia s·∫ª √Ω ki·∫øn.",
    "momo": "V√≠ ƒëi·ªán t·ª≠, thanh to√°n di ƒë·ªông.",
    "spotify": "Nghe nh·∫°c tr·ª±c tuy·∫øn.",
    "google maps": "B·∫£n ƒë·ªì, ch·ªâ ƒë∆∞·ªùng v√† ƒë·ªãnh v·ªã.",
    "google search": "T√¨m ki·∫øm th√¥ng tin.",
    "google": "·ª®ng d·ª•ng Google t·ªïng h·ª£p.",
    "google drive": "L∆∞u tr·ªØ v√† chia s·∫ª t·ªáp.",
    "google photos": "L∆∞u tr·ªØ & chia s·∫ª ·∫£nh.",
    // Th√™m c√°c app ph·ªï bi·∫øn kh√°c n·∫øu mu·ªën
  };

  searchBtn.addEventListener('click', searchApp);
  appNameInput.addEventListener('keydown', function (e) {
    if (e.key === 'Enter') searchApp();
  });

  homeLink.addEventListener('click', function (e) {
    e.preventDefault();
    if (arrow) {
      arrow.style.transform = "translateX(-50px)";
      arrow.style.opacity = "0";
    }
    setTimeout(function () { window.location.href = "https://nhut990.github.io"; }, 400);
  });

  function fetchWithFallback(url, timeoutMs) {
    timeoutMs = timeoutMs || 10000;
    return new Promise(function (resolve, reject) {
      var settled = false;
      function done(ok, data) { if (!settled) { settled = true; ok ? resolve(data) : reject(data); } }

      if (window.fetch) {
        var timer = setTimeout(() => done(false, new Error("Timeout")), timeoutMs);
        fetch(url)
          .then(r => { clearTimeout(timer); return r.ok ? r.json() : Promise.reject(); })
          .then(d => done(true, d))
          .catch(() => tryXHR());
      } else tryXHR();

      function tryXHR() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.timeout = timeoutMs;
        xhr.onload = function () {
          if (xhr.status >= 200 && xhr.status < 300) {
            try { done(true, JSON.parse(xhr.responseText)); }
            catch { tryJSONP(); }
          } else tryJSONP();
        };
        xhr.onerror = xhr.ontimeout = () => tryJSONP();
        xhr.send();
      }

      function tryJSONP() {
        var cb = 'itunes_cb_' + Math.floor(Math.random() * 1000000);
        var s = document.createElement('script');
        var timer = setTimeout(() => cleanup(false, new Error("Timeout")), timeoutMs);
        window[cb] = d => cleanup(true, d);
        function cleanup(ok, d) {
          clearTimeout(timer);
          delete window[cb];
          s.remove();
          done(ok, d);
        }
        s.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + cb;
        s.onerror = () => cleanup(false, new Error("Load failed"));
        document.head.appendChild(s);
      }
    });
  }

  function searchApp() {
    var name = (appNameInput.value || '').trim();
    var country = countrySelect.value;
    resultsDiv.innerHTML = 'üîç ƒêang t√¨m...';
    copyNote.style.display = 'none';
    if (!name) return resultsDiv.innerHTML = '‚ö†Ô∏è Vui l√≤ng nh·∫≠p t√™n ·ª©ng d·ª•ng.';

    var term = typeof String.prototype.normalize === 'function'
      ? name.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase()
      : name.toLowerCase();

    var url = 'https://itunes.apple.com/search?term=' + encodeURIComponent(term) +
              '&country=' + encodeURIComponent(country) + '&entity=software&limit=10';

    fetchWithFallback(url, 10000).then(data => {
      if (!data.results || !data.results.length)
        return resultsDiv.innerHTML = '‚ùå Kh√¥ng t√¨m th·∫•y ·ª©ng d·ª•ng n√†o trong khu v·ª±c n√†y.';
      renderResults(data.results);
    }).catch(err => {
      resultsDiv.innerHTML = '‚ö†Ô∏è L·ªói khi truy v·∫•n API (' + (err.message || 'Load failed.') + ').';
    });
  }

  function getShortDesc(appName, appDescription) {
    if (!appName) return "·ª®ng d·ª•ng ch∆∞a c√≥ m√¥ t·∫£ ng·∫Øn.";
    var key = appName.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
    key = key.replace(/[^a-z0-9 ]/g, ''); // gi·ªØ l·∫°i kho·∫£ng tr·∫Øng cho c√°c t√™n nh∆∞ "google maps"
    key = key.trim();
    // T√¨m trong danh s√°ch m√¥ t·∫£ ng·∫Øn
    for (var k in SHORT_DESCS) {
      if (key === k || key.includes(k)) return SHORT_DESCS[k];
    }
    // N·∫øu kh√¥ng c√≥, l·∫•y d√≤ng ƒë·∫ßu ti√™n t·ª´ description (n·∫øu c√≥), c·∫Øt ng·∫Øn 60 k√Ω t·ª±
    if (appDescription) {
      var firstSentence = appDescription.split('. ')[0];
      if (firstSentence.length > 60) firstSentence = firstSentence.substring(0, 60) + "...";
      return firstSentence;
    }
    return "·ª®ng d·ª•ng ch∆∞a c√≥ m√¥ t·∫£ ng·∫Øn.";
  }

  function renderResults(apps) {
    resultsDiv.innerHTML = '';
    copyNote.style.display = 'block';

    apps.forEach(function (app) {
      var appEl = document.createElement('div');
      appEl.className = 'app';

      var link = document.createElement('a');
      link.href = app.trackViewUrl || '#';
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.title = 'M·ªü trong App Store';

      var img = document.createElement('img');
      img.src = app.artworkUrl100 || placeholderUrl;
      img.alt = app.trackName || 'App';
      img.onerror = function () { this.src = placeholderUrl; };

      link.appendChild(img);
      appEl.appendChild(link);

      var info = document.createElement('div');
      info.className = 'app-info';

      var title = document.createElement('div');
      var b = document.createElement('b');
      b.style.color = '#007aff';
      b.textContent = app.trackName || 'Kh√¥ng r√µ';
      title.appendChild(b);

      var versionSpan = document.createElement('span');
      versionSpan.style.color = '#555';
      versionSpan.style.marginLeft = '6px';
      versionSpan.textContent = '(v' + (app.version || app.versionString || 'N/A') + ')';
      title.appendChild(versionSpan);
      info.appendChild(title);

      // M√¥ t·∫£ ng·∫Øn
      var shortDesc = document.createElement('span');
      shortDesc.className = 'short-desc';
      shortDesc.textContent = getShortDesc(app.trackName, app.description);
      info.appendChild(shortDesc);

      var bundleLine = document.createElement('div');
      var bundleSpan = document.createElement('span');
      bundleSpan.className = 'bundle';
      if (app.bundleId) {
        bundleSpan.textContent = app.bundleId;
        bundleSpan.onclick = function () { copyBundle(app.bundleId); };
      } else {
        bundleSpan.textContent = 'Kh√¥ng r√µ';
        bundleSpan.className += ' disabled';
      }
      bundleLine.appendChild(bundleSpan);
      info.appendChild(bundleLine);

      var seller = document.createElement('div');
      seller.innerHTML = '<small>' + escapeHtml(app.sellerName || 'Kh√¥ng r√µ') + '</small>';
      info.appendChild(seller);

      var iosReq = document.createElement('div');
      iosReq.innerHTML = '<small>Y√™u c·∫ßu: ' + escapeHtml(app.minimumOsVersion || 'Kh√¥ng r√µ') + ' tr·ªü l√™n</small>';
      info.appendChild(iosReq);

      var updated = document.createElement('div');
      var dateText = app.currentVersionReleaseDate ? new Date(app.currentVersionReleaseDate).toLocaleDateString('vi-VN') : 'Kh√¥ng r√µ';
      updated.innerHTML = '<small>C·∫≠p nh·∫≠t: ' + escapeHtml(dateText) + '</small>';
      info.appendChild(updated);

      var price = document.createElement('div');
      price.innerHTML = '<small>' + escapeHtml(app.formattedPrice || (app.price === 0 || app.price === '0' ? 'Free' : 'Free')) + '</small>';
      info.appendChild(price);

      // Th√™m ph·∫ßn hi·ªÉn th·ªã k√≠ch c·ª° n·∫øu c√≥
      if (app.fileSizeBytes) {
        var sizeMB = (parseInt(app.fileSizeBytes, 10) / (1024 * 1024)).toFixed(1);
        var size = document.createElement('div');
        size.innerHTML = '<small>K√≠ch c·ª°: ' + sizeMB + ' MB</small>';
        info.appendChild(size);
      }

      appEl.appendChild(info);
      resultsDiv.appendChild(appEl);
    });
  }

  function copyBundle(bundle) {
    if (!bundle) return;
    var showCopied = function (text) {
      var temp = document.createElement('div');
      temp.textContent = '‚úÖ ƒê√£ sao ch√©p: ' + text;
      temp.style.position = 'fixed';
      temp.style.bottom = '20px';
      temp.style.left = '50%';
      temp.style.transform = 'translateX(-50%)';
      temp.style.background = 'rgba(0,0,0,0.8)';
      temp.style.color = 'white';
      temp.style.padding = '8px 14px';
      temp.style.borderRadius = '10px';
      temp.style.fontSize = '14px';
      temp.style.zIndex = '9999';
      document.body.appendChild(temp);
      setTimeout(() => temp.remove(), 1500);
    };

    if (navigator.clipboard && navigator.clipboard.writeText)
      navigator.clipboard.writeText(bundle).then(() => showCopied(bundle))
      .catch(() => fallbackCopy(bundle, showCopied));
    else fallbackCopy(bundle, showCopied);
  }

  function fallbackCopy(text, cb) {
    var input = document.createElement('textarea');
    input.value = text;
    input.style.position = 'fixed';
    input.style.left = '-9999px';
    document.body.appendChild(input);
    input.select();
    try {
      document.execCommand('copy');
      cb(text);
    } catch (e) { console.error('Copy fallback failed', e); }
    document.body.removeChild(input);
  }

  function escapeHtml(str) {
    if (!str) return '';
    return String(str).replace(/[&<>"'`=\/]/g, s => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;',
      '/': '&#x2F;', '`': '&#x60;', '=': '&#x3D;'
    }[s]));
  }
})();
</script>
</body>
</html>