<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>L·∫•y icon ·ª©ng d·ª•ng App Store</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
      text-align: center;
    }
    h2 {
      color: #333;
    }
    .input-group {
      margin-bottom: 15px;
    }
    input[type="text"] {
      width: 80%;
      padding: 10px;
      font-size: 16px;
    }
    select {
      padding: 10px;
      font-size: 16px;
      margin-left: 8px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background-color: #0056b3;
    }
    #result {
      margin-top: 20px;
    }
    img {
      max-width: 150px;
      margin-top: 10px;
    }
    a {
      display: inline-block;
      margin-top: 10px;
      color: #007bff;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .error {
      color: red;
    }
    .loading {
      color: #555;
    }
  </style>
</head>
<body>
  <h2>Nh·∫≠p link ·ª©ng d·ª•ng tr√™n App Store</h2>
  <div class="input-group">
    <input
      type="text"
      id="appLink"
      placeholder="v√≠ d·ª• https://apps.apple.com/vn/app/youtube/id544007664?l=vi"
      oninput="clearResult()"
    />
    <select id="iconQuality">
      <option value="artworkUrl512">Cao (512x512)</option>
      <option value="artworkUrl100">Trung b√¨nh (100x100)</option>
      <option value="artworkUrl60">Th·∫•p (~60x60)</option>
    </select>
  </div>
  <button onclick="getAppIcon()">L·∫•y icon</button>
  <div id="result"></div>

  <script>
    function clearResult() {
      document.getElementById("result").innerHTML = "";
    }

    async function getAppIcon() {
      const link = document.getElementById("appLink").value.trim();
      const quality = document.getElementById("iconQuality").value;
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      // Ki·ªÉm tra ƒë·ªãnh d·∫°ng link
      const match = link.match(/id(\d+)/);
      if (!/^https?:\/\/apps\.apple\.com\/.+\/app\/.+\/id\d+/.test(link) || !match) {
        resultDiv.innerHTML = "<p class='error'>‚ùå Link kh√¥ng h·ª£p l·ªá ho·∫∑c kh√¥ng ch·ª©a ID ·ª©ng d·ª•ng.</p>";
        return;
      }

      const appId = match[1];
      const apiUrl = `https://itunes.apple.com/lookup?id=${appId}&country=VN`;

      resultDiv.innerHTML = "<p class='loading'>‚è≥ ƒêang t·∫£i d·ªØ li·ªáu ·ª©ng d·ª•ng...</p>";

      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn API");

        const data = await response.json();
        if (!data || data.resultCount === 0 || !data.results[0]) {
          resultDiv.innerHTML = "<p class='error'>‚ùå Kh√¥ng t√¨m th·∫•y ·ª©ng d·ª•ng.</p>";
          return;
        }

        const app = data.results[0];
        const icons = {
          artworkUrl512: app.artworkUrl512,
          artworkUrl100: app.artworkUrl100,
          artworkUrl60: app.artworkUrl60
        };
        const trackName = app.trackName || "·ª®ng d·ª•ng kh√¥ng c√≥ t√™n";
        const iconUrl = icons[quality];

        if (!iconUrl) {
          resultDiv.innerHTML = `<p class='error'>‚ùå ·ª®ng d·ª•ng kh√¥ng c√≥ icon v·ªõi ch·∫•t l∆∞·ª£ng n√†y.</p>`;
          return;
        }

        let label = "";
        if (quality === "artworkUrl512") label = "Cao (512x512)";
        else if (quality === "artworkUrl100") label = "Trung b√¨nh (100x100)";
        else if (quality === "artworkUrl60") label = "Th·∫•p (~60x60)";

        resultDiv.innerHTML = `
          <p><strong>${trackName}</strong></p>
          <p>Ch·∫•t l∆∞·ª£ng: <b>${label}</b></p>
          <img src="${iconUrl}" alt="App Icon">
          <br><a href="${iconUrl}" download>üì• T·∫£i icon (${label})</a>
        `;
      } catch (error) {
        console.error("L·ªói:", error);
        resultDiv.innerHTML = "<p class='error'>‚ùå ƒê√£ x·∫£y ra l·ªói khi t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i sau.</p>";
      }
    }
  </script>
</body>
</html>